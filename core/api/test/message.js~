'use strict';
var _             = require('lodash'),
    async         = require('async'),
    practitioners = require('../practitioners'),
    patients      = require('../patients'),
    errors        = require('../../errors'),
    messaging     = require('../../messaging');

module.exports = function(Test) { 
    Test.message = function(data, options, cb) { 
	async.waterfall([ 
	    function(next) { 
		// var message =  "Dear " +  "Sriharsha" + "," + " " +
		// 	       "your appointment with " + "Dr. " + "Dre" + " " +
		// 	       "at " + "Bangalore" + " " +
		// 	       "has been CONFIRMED for " + "2015-09-29T20:00:00Z"  +  "." + " " +
		// 	       "We will get contact you if there are any changes." + " " +
		// 	       "Thanks â€“ Team Physios.in";


		// var message = "Your confirmation code for Physios.in is 1234." + 
		//               " Thanks Team Physios.in";

		var message = "Your OTP for One Health Physio is XXXX. Thanks";

		var options = {
		    "message": message,
		    "number": "+" + "9741566994"
		};

		messaging.sendMessage(options,  function(err, response) {
		    if (err) {
			return next(err, null);
		    }

		    if (response.statusCode !== 200) {
			return next(err, null);
		    }
		    next(null, {"message": "Message successfully sent"});
		});
	    } 
	], cb);
    };
};
